
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      <link rel="shortcut icon" href="../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-6.1.3">
    
    
      
        <title>Using the Dataset class - HYDRAFloods Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.2cb7adb3.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.f0267088.min.css">
        
      
    
    
    
      
        
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/extra.css">
    
    
      
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="" data-md-color-primary="none" data-md-color-accent="none">
      
  
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#dataset-structure" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header-nav md-grid" aria-label="Header">
    <a href=".." title="HYDRAFloods Documentation" class="md-header-nav__button md-logo" aria-label="HYDRAFloods Documentation">
      
  <img src="../img/hydrafloods_logo.png" alt="logo">

    </a>
    <label class="md-header-nav__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header-nav__title" data-md-component="header-title">
      
        <div class="md-header-nav__ellipsis">
          <span class="md-header-nav__topic md-ellipsis">
            HYDRAFloods Documentation
          </span>
          <span class="md-header-nav__topic md-ellipsis">
            
              Using the Dataset class
            
          </span>
        </div>
      
    </div>
    
      <label class="md-header-nav__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="HYDRAFloods Documentation" class="md-nav__button md-logo" aria-label="HYDRAFloods Documentation">
      
  <img src="../img/hydrafloods_logo.png" alt="logo">

    </a>
    HYDRAFloods Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      


  <li class="md-nav__item">
    <a href=".." class="md-nav__link">
      Overview
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../installation/" class="md-nav__link">
      Installation
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../getting-started/" class="md-nav__link">
      Getting Started
    </a>
  </li>

    
      
      
      

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Using the Dataset class
        <span class="md-nav__icon md-icon"></span>
      </label>
    
    <a href="./" class="md-nav__link md-nav__link--active">
      Using the Dataset class
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dataset-structure" class="md-nav__link">
    Dataset structure
  </a>
  
    <nav class="md-nav" aria-label="Dataset structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specialized-datasets" class="md-nav__link">
    Specialized Datasets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-a-function" class="md-nav__link">
    Applying a function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merging-datasets" class="md-nav__link">
    Merging Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joining-datasets" class="md-nav__link">
    Joining Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temporal-aggregation" class="md-nav__link">
    Temporal aggregation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-your-own-dataset-class" class="md-nav__link">
    Writing your own dataset class
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../algorithms/" class="md-nav__link">
      Algorithms
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../workflow-example/" class="md-nav__link">
      Workflow Example
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item">
    <a href="../cli/" class="md-nav__link">
      Command Line Interface
    </a>
  </li>

    
      
      
      


  <li class="md-nav__item md-nav__item--nested">
    
      <input class="md-nav__toggle md-toggle" data-md-toggle="nav-8" type="checkbox" id="nav-8">
    
    <label class="md-nav__link" for="nav-8">
      API Reference
      <span class="md-nav__icon md-icon"></span>
    </label>
    <nav class="md-nav" aria-label="API Reference" data-md-level="1">
      <label class="md-nav__title" for="nav-8">
        <span class="md-nav__icon md-icon"></span>
        API Reference
      </label>
      <ul class="md-nav__list" data-md-scrollfix>
        
        
          
          
          


  <li class="md-nav__item">
    <a href="../datasets/" class="md-nav__link">
      datasets module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../decorators/" class="md-nav__link">
      decorators module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../geeutils/" class="md-nav__link">
      geeutils module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../fetch/" class="md-nav__link">
      fetch module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../filtering/" class="md-nav__link">
      filtering module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../ml/" class="md-nav__link">
      ml module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../thresholding/" class="md-nav__link">
      thresholding module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../timeseries/" class="md-nav__link">
      timeseries module
    </a>
  </li>

        
          
          
          


  <li class="md-nav__item">
    <a href="../utils/" class="md-nav__link">
      utils module
    </a>
  </li>

        
      </ul>
    </nav>
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#dataset-structure" class="md-nav__link">
    Dataset structure
  </a>
  
    <nav class="md-nav" aria-label="Dataset structure">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#specialized-datasets" class="md-nav__link">
    Specialized Datasets
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#applying-a-function" class="md-nav__link">
    Applying a function
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#merging-datasets" class="md-nav__link">
    Merging Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#joining-datasets" class="md-nav__link">
    Joining Datasets
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#temporal-aggregation" class="md-nav__link">
    Temporal aggregation
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#writing-your-own-dataset-class" class="md-nav__link">
    Writing your own dataset class
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                
                  <h1>Using the Dataset class</h1>
                
                <p>Here are a more in depth examples of using <code>hydrafloods.Dataset</code> classes for working with imagery. It is expected that the code is run in an interactive python session such as IPython or in a Jupyter Notebook as later code blocks will use variables from previous ones.</p>
<div class="codehilite"><pre><span></span><code><span class="kn">import</span> <span class="nn">ee</span>
<span class="n">ee</span><span class="o">.</span><span class="n">Initialze</span><span class="p">()</span>
<span class="kn">import</span> <span class="nn">hydrafloods</span> <span class="k">as</span> <span class="nn">hf</span>
</code></pre></div>

<h2 id="dataset-structure">Dataset structure</h2>
<div class="codehilite"><pre><span></span><code><span class="n">region</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">country_bbox</span><span class="p">(</span><span class="s2">&quot;Cambodia&quot;</span><span class="p">)</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2019-01-01&quot;</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2019-07-01&quot;</span>

<span class="c1"># get a Landsat 8 collection</span>
<span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">lc8</span><span class="p">)</span>
<span class="c1"># should look like </span>
<span class="c1"># HYDRAFloods Dataset:</span>
<span class="c1"># {&#39;asset_id&#39;: &#39;LANDSAT/LC08/C01/T1_SR&#39;,</span>
<span class="c1">#  &#39;end_time&#39;: &#39;2019-07-01&#39;,</span>
<span class="c1">#  &#39;name&#39;: &#39;Landsat8&#39;,</span>
<span class="c1">#  &#39;region&#39;: [[[...], [...], [...], [...], [...]]],</span>
<span class="c1">#  &#39;start_time&#39;: &#39;2019-01-01&#39;}</span>
</code></pre></div>

<p>A dataset object has a few properties that we can access to assist in processing or understanding the data contained in the dataset. Here is a list of properties and a description:</p>
<ul>
<li><code>Dataset.collection</code>: Earth Engine image collection object that the dataset class wraps</li>
<li><code>Dataset.n_images</code>: client side number of images in collection</li>
<li><code>Dataset.dates</code>: client side list of datetime information of all images acquisition times</li>
</ul>
<p>Let's inspect some of these properties</p>
<div class="codehilite"><pre><span></span><code><span class="nb">print</span><span class="p">(</span><span class="n">lc8</span><span class="o">.</span><span class="n">n_images</span><span class="p">)</span>
<span class="c1"># should equal 197</span>

<span class="nb">print</span><span class="p">(</span><span class="n">lc8</span><span class="o">.</span><span class="n">dates</span><span class="p">)</span>
<span class="c1"># should look something like </span>
<span class="c1"># [&#39;2019-01-12 03:06:42.950&#39;,</span>
<span class="c1">#  &#39;2019-01-28 03:06:38.990&#39;,</span>
<span class="c1">#  ... ,</span>
<span class="c1"># &#39;2019-06-01 03:32:06.850&#39;]</span>

<span class="c1"># since `Dataset.collection` is a server side object we will just</span>
<span class="c1"># check that it is in fact a ee.ImageCollection object</span>
<span class="nb">print</span><span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">lc8</span><span class="o">.</span><span class="n">collection</span><span class="p">,</span> <span class="n">ee</span><span class="o">.</span><span class="n">ImageCollection</span><span class="p">))</span>
<span class="c1"># should == True</span>
</code></pre></div>

<h3 id="specialized-datasets">Specialized Datasets</h3>
<p><code>hydrafloods</code> has specialized datasets classes that extend a <code>hydrafloods.Dataset</code> class and are common image collections used in surface water mapping. These specialized datasets include a custom <code>qa()</code> method that gets called on initialization to mask poor quality pixels and custom methods that make harmonization easy. Furthermore, the optical sensor bands are automatically renamed to a common scheme so that they can be used together easily. Here is a list of the specialized datasets with links to information on methods:</p>
<p>Really, one can think of the custom <code>qa()</code> method as a preprocessing step that you would like to happen on <em>all</em> images in the dataset so it is not just restricted to specific sensors as seen in a later section.</p>
<ul>
<li>Sentinel 1: <a href="/datasets/#hydrafloods.datasets.Sentinel1"><code>hydrafloods.Sentinel1</code></a></li>
<li>Sentinel 2: <a href="/datasets/#hydrafloods.datasets.Sentinel2"><code>hydrafloods.Sentinel2</code></a></li>
<li>Landsat 8: <a href="/datasets/#hydrafloods.datasets.Landsat8"><code>hydrafloods.Landsat8</code></a></li>
<li>Landsat 7: <a href="/datasets/#hydrafloods.datasets.Landsat7"><code>hydrafloods.Landsat7</code></a></li>
<li>VIIRS: <a href="/datasets/#hydrafloods.datasets.Viirs"><code>hydrafloods.Viirs</code></a></li>
<li>MODIS: <a href="/datasets/#hydrafloods.datasets.Modis"><code>hydrafloods.Modis</code></a></li>
</ul>
<p>To provide an example of using the internal <code>qa()</code> method and not we can redefine the Landsat 8 collection from before but with setting <code>use_qa</code> to <code>False</code></p>
<div class="codehilite"><pre><span></span><code><span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="n">lc8_noqa</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">,</span><span class="n">use_qa</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="n">thumb_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mi">5500</span><span class="p">,</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span><span class="s2">&quot;swir2,nir,green&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1024</span>
<span class="p">}</span>

<span class="c1"># get thumbnail images</span>
<span class="n">qa_thumb</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">lc8</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="o">.</span><span class="n">getThumbURL</span><span class="p">(</span><span class="n">thumb_params</span><span class="p">)</span>
<span class="p">)</span>

<span class="n">noqa_thumb</span> <span class="o">=</span> <span class="p">(</span>
    <span class="n">lc8_noqa</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
    <span class="o">.</span><span class="n">getThumbURL</span><span class="p">(</span><span class="n">thumb_params</span><span class="p">)</span>
<span class="p">)</span>

<span class="c1"># print urls to view thumbnails</span>
<span class="nb">print</span><span class="p">(</span><span class="n">qa_thumb</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">noqa_thumb</span><span class="p">)</span>
</code></pre></div>

<table>
<thead>
<tr>
<th align="center"><code>use_qa = True</code></th>
<th align="center"><code>use_qa = False</code></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="../img/datasets_lc8_qa.png" /></td>
<td align="center"><img alt="" src="../img/datasets_lc8_noqa.png" /></td>
</tr>
</tbody>
</table>
<p>We can clearly see the image on the left has clouds and cloud shadows masked and can therefore be used directly in analysis with minimal effort. More information on the internals of these specialized datasets and how you can write your own can be found at the <a href="#writing-your-own-dataset-class">Writing your own dataset class</a> section.</p>
<h2 id="applying-a-function">Applying a function</h2>
<h2 id="merging-datasets">Merging Datasets</h2>
<p>One of the simpilist ways to combine datasets is to merge. This takes the imagery in one collection and concatenates it with the original collection. We can use the <a href="/datasets/#hydrafloods.datasets.Dataset.merge"><code>merge()</code></a> method to accomplish this. Additioanlly, the <code>merge()</code> method automatically sorts the image collections in time so we can start using dense time series right away. Here is an example of merging Landat8 and Sentinel2 datasets together:</p>
<div class="codehilite"><pre><span></span><code><span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># has 197 image</span>

<span class="n">s2</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Sentinel2</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># has 2400 images</span>

<span class="n">merged</span> <span class="o">=</span> <span class="n">lc8</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">merged</span><span class="o">.</span><span class="n">n_images</span><span class="p">)</span>
<span class="c1"># now has 2597 images!</span>
</code></pre></div>

<h2 id="joining-datasets">Joining Datasets</h2>
<p>Joining datasets is another way to bring together two datasets but by looking at coincident imagery and combines the bands into one image. Whereas merge combined the two collections irrespective of space time overlap, <a href="/datasets/#hydrafloods.datasets.Dataset.join"><code>join()</code></a> looks for overlapping data in space and time and will return only data that overlaps with the bands combined. Furthermore, the resulting images will be clipped to the overlapping region. This functionality is really helpful when looking for coincident data from multiple sensors.</p>
<div class="codehilite"><pre><span></span><code><span class="n">lc8</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Landsat8</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># has 197 images</span>

<span class="n">s1</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Sentinel1</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span>
<span class="c1"># has 628 images</span>

<span class="n">joined</span> <span class="o">=</span> <span class="n">lc8</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
<span class="c1"># has 131 coincident images</span>

<span class="c1"># grab the first image in the collection</span>
<span class="c1"># will have optical and sar bands </span>
<span class="n">first</span> <span class="o">=</span> <span class="n">joined</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="n">first</span><span class="o">.</span><span class="n">bandNames</span><span class="p">()</span><span class="o">.</span><span class="n">getInfo</span><span class="p">())</span>
<span class="c1"># should equal the following:</span>
<span class="c1"># [&#39;blue&#39;, &#39;green&#39;, &#39;red&#39;, &#39;nir&#39;, &#39;swir1&#39;, &#39;swir2&#39;, &#39;VV&#39;, &#39;VH&#39;, &#39;angle&#39;]</span>
<span class="c1"># both optical and SAR bands are included in the image</span>

<span class="c1"># visualize the different bands</span>
<span class="n">optical_thumb</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="mi">50</span><span class="p">,</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mi">5500</span><span class="p">,</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span><span class="s2">&quot;swir2,nir,green&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1024</span>
<span class="p">})</span>
<span class="n">sar_thumb</span> <span class="o">=</span> <span class="n">first</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">({</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:[</span><span class="o">-</span><span class="mi">25</span><span class="p">,</span><span class="o">-</span><span class="mi">30</span><span class="p">,</span><span class="o">-</span><span class="mi">25</span><span class="p">],</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:[</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="mi">5</span><span class="p">,</span><span class="mi">0</span><span class="p">],</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span><span class="s2">&quot;VV,VH,VV&quot;</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1024</span>
<span class="p">})</span>

<span class="c1"># print urls to view thumbnails</span>
<span class="nb">print</span><span class="p">(</span><span class="n">optical_thumb</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">sar_thumb</span><span class="p">)</span>
</code></pre></div>

<table>
<thead>
<tr>
<th align="center">Landsat 8 2019-01-28</th>
<th align="center">Sentinel 1 2019-01-28</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="../img/datasets_lc8_joined.png" /></td>
<td align="center"><img alt="" src="../img/datasets_s1_joined.png" /></td>
</tr>
</tbody>
</table>
<h2 id="temporal-aggregation">Temporal aggregation</h2>
<p>A common workflow is merging data and make composites for individual dates that data is available. A good example of this is the MODIS sensor that is onboard the Terra and Aqua satellite. We can create daily composites of the imagery by merging the datasets then looping over each day to mosaic the data. <code>hydrafloods</code> has a method <a href="/datasets/#hydrafloods.datasets.Dataset.aggregate_time"><code>aggregate_time()</code></a> to do the mosiacing sequentially in time. Here we create a combined MODIS Terra and Aqua dataset.</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># define new time range</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2018-11-03&quot;</span>  
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2018-11-15&quot;</span> 

<span class="c1"># get the terra MODIS dataset</span>
<span class="n">terra</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Modis</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span> 
<span class="c1"># get the aqua MODIS dataset</span>
<span class="c1"># note calling the asset_id explicitly</span>
<span class="n">aqua</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Modis</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">,</span><span class="n">asset_id</span><span class="o">=</span><span class="s2">&quot;MODIS/006/MYD09GA&quot;</span><span class="p">)</span>

<span class="c1"># merge the collections into one</span>
<span class="n">merged</span> <span class="o">=</span> <span class="n">terra</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">aqua</span><span class="p">)</span>
<span class="c1"># aggregate in time</span>
<span class="n">agg</span> <span class="o">=</span> <span class="n">merged</span><span class="o">.</span><span class="n">aggregate_time</span><span class="p">(</span><span class="n">reducer</span><span class="o">=</span><span class="s2">&quot;median&quot;</span><span class="p">)</span>
</code></pre></div>

<table>
<thead>
<tr>
<th align="center">MODIS Terra 2018-11-03</th>
<th align="center">MODIS Aqua 2018-11-03</th>
<th align="center">Aggregated</th>
</tr>
</thead>
<tbody>
<tr>
<td align="center"><img alt="" src="../img/datasets_terra_noagg.png" /></td>
<td align="center"><img alt="" src="../img/datasets_aqua_noagg.png" /></td>
<td align="center"><img alt="" src="../img/datasets_terra_aqua_agg.png" /></td>
</tr>
</tbody>
</table>
<p>By doing this we can fill in gaps where some data is missing with other sensors. We see in the above example that combining the MODIS data from Terra and Aqua we can get more coverage in the event of flooding. By default the method will take unique dates within the dataset and aggregate by one day as seen in the above example.</p>
<p>We can also use this functionality to make monthly or yearly composites of data by specifying the dates that we want to start the aggregation with and a period after the start dates to do the aggregation. Here is an example creating yearly composites from 2015 through 2019:</p>
<div class="codehilite"><pre><span></span><code><span class="c1"># define new time range</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="s2">&quot;2015-01-01&quot;</span>  
<span class="n">end_time</span> <span class="o">=</span> <span class="s2">&quot;2020-01-01&quot;</span> 

<span class="c1"># define the dates in which to start aggregation</span>
<span class="n">year_starts</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;2015-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;2016-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;2017-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;2018-01-01&quot;</span><span class="p">,</span><span class="s2">&quot;2019-01-01&quot;</span><span class="p">]</span>

<span class="c1"># get the terra MODIS dataset</span>
<span class="n">terra</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">Modis</span><span class="p">(</span><span class="n">region</span><span class="p">,</span><span class="n">start_time</span><span class="p">,</span><span class="n">end_time</span><span class="p">)</span> 
<span class="c1"># apply the aggregation </span>
<span class="n">yearly</span> <span class="o">=</span> <span class="n">terra</span><span class="o">.</span><span class="n">aggregate_time</span><span class="p">(</span><span class="n">dates</span><span class="o">=</span><span class="n">year_starts</span><span class="p">,</span><span class="n">period</span><span class="o">=</span><span class="mi">365</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="n">yearly</span><span class="o">.</span><span class="n">dates</span><span class="p">)</span>
<span class="c1"># should equal to:</span>
<span class="c1"># [&#39;2015-01-01 00:00:00.000&#39;,</span>
<span class="c1">#  &#39;2016-01-01 00:00:00.000&#39;,</span>
<span class="c1">#  &#39;2017-01-01 00:00:00.000&#39;,</span>
<span class="c1">#  &#39;2018-01-01 00:00:00.000&#39;,</span>
<span class="c1">#  &#39;2019-01-01 00:00:00.000&#39;]</span>
</code></pre></div>

<p>As seen, this method allows for customization of when to start aggregations and how long/which dates to include in aggregation which can be helpful for unique timings like dekads.</p>
<h2 id="writing-your-own-dataset-class">Writing your own dataset class</h2>
<p>The <code>hydrafloods.Dataset</code> class can be used to create custom dataset classes for sensors. This is helpful when there is a sensor that will be used often with other datasets using <code>hydrafloods</code>. Here is an example of writing a custom <code>hydrafloods.Dataset</code> class for the GOES16 collection. We will predefine the <code>asset_id</code> argument and define a <code>qa()</code> method to scale data to reflectance and mask poor quality pixels.</p>
<div class="codehilite"><pre><span></span><code><span class="k">class</span> <span class="nc">Goes16</span><span class="p">(</span><span class="n">hf</span><span class="o">.</span><span class="n">Dataset</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">asset_id</span><span class="o">=</span><span class="s2">&quot;NOAA/GOES/16/MCMIPF&quot;</span><span class="p">,</span> <span class="n">use_qa</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="c1"># initialize the parent class</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">Goes16</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="n">asset_id</span><span class="o">=</span><span class="n">asset_id</span><span class="p">,</span> <span class="n">use_qa</span><span class="o">=</span><span class="n">use_qa</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>

        <span class="c1"># list of band names to return with new names</span>
        <span class="n">old_band_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;CMI_C01&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;CMI_C02&quot;</span><span class="p">,</span><span class="s2">&quot;CMI_C03&quot;</span><span class="p">,</span><span class="s2">&quot;CMI_C05&quot;</span><span class="p">,</span><span class="s2">&quot;CMI_C06&quot;</span><span class="p">]</span>
        <span class="n">new_band_names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;blue&quot;</span><span class="p">,</span><span class="s2">&quot;green&quot;</span><span class="p">,</span><span class="s2">&quot;red&quot;</span><span class="p">,</span><span class="s2">&quot;nir&quot;</span><span class="p">,</span><span class="s2">&quot;swir1&quot;</span><span class="p">,</span><span class="s2">&quot;swir2&quot;</span><span class="p">]</span>

        <span class="c1"># change the band names to something</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">collection</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">select</span><span class="p">(</span>
            <span class="n">old_band_names</span><span class="p">,</span> <span class="n">new_band_names</span>
        <span class="p">)</span>

        <span class="k">return</span>

    <span class="c1"># define a qa method and wrap in the carry_metadata decorator</span>
    <span class="c1"># retains metadata for each image</span>
    <span class="c1"># qa() will get called on super() if use_qa==True</span>
    <span class="nd">@hf</span><span class="o">.</span><span class="n">decorators</span><span class="o">.</span><span class="n">carry_metadata</span>
    <span class="k">def</span> <span class="nf">qa</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">img</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Custom QA masking method for Goes17 data</span>
<span class="sd">        Scales data to reflectance and finds poor quality images</span>
<span class="sd">        add a psuedo-green band using methods from https://doi.org/10.1029/2018EA000379</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">band_names</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">bandNames</span><span class="p">()</span>

        <span class="c1"># get scale and offset values</span>
        <span class="n">scale_properties</span> <span class="o">=</span> <span class="n">band_names</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="s2">&quot;_scale&quot;</span><span class="p">))</span>
        <span class="n">offset_properties</span> <span class="o">=</span> <span class="n">band_names</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">ee</span><span class="o">.</span><span class="n">String</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">cat</span><span class="p">(</span><span class="s2">&quot;_offset&quot;</span><span class="p">))</span>

        <span class="c1"># convert scale/offset values to image</span>
        <span class="n">scale_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">toDictionary</span><span class="p">(</span><span class="n">scale_properties</span><span class="p">)</span><span class="o">.</span><span class="n">toImage</span><span class="p">()</span>
        <span class="n">offset_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">toDictionary</span><span class="p">(</span><span class="n">offset_properties</span><span class="p">)</span><span class="o">.</span><span class="n">toImage</span><span class="p">()</span>

        <span class="c1"># get qa bands and set 0 to 1 and everything else to 0</span>
        <span class="n">qa_img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;^(DQF).*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">Not</span><span class="p">()</span>

        <span class="c1"># get the actual image data and apply qa mask</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">(</span><span class="s2">&quot;^(CMI).*&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">updateMask</span><span class="p">(</span><span class="n">qa_img</span><span class="p">)</span>

        <span class="c1"># scale imagery to reflectance</span>
        <span class="n">img</span> <span class="o">=</span> <span class="n">img</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">scale_img</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">offset_img</span><span class="p">)</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">qa_img</span><span class="p">)</span>

        <span class="c1"># compute psuedo green band</span>
        <span class="n">green_weights</span> <span class="o">=</span> <span class="n">ee</span><span class="o">.</span><span class="n">Image</span><span class="o">.</span><span class="n">constant</span><span class="p">([</span><span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.45</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">])</span>
        <span class="n">green_band</span> <span class="o">=</span> <span class="p">(</span>
            <span class="n">img</span><span class="o">.</span><span class="n">select</span><span class="p">([</span><span class="s2">&quot;CMI_C01&quot;</span><span class="p">,</span> <span class="s2">&quot;CMI_C02&quot;</span><span class="p">,</span> <span class="s2">&quot;CMI_C03&quot;</span><span class="p">])</span>
            <span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">green_weights</span><span class="p">)</span>
            <span class="o">.</span><span class="n">reduce</span><span class="p">(</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span>
            <span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="s2">&quot;green&quot;</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">img</span><span class="o">.</span><span class="n">addBands</span><span class="p">(</span><span class="n">green_band</span><span class="p">)</span>


<span class="c1"># get a GOES collection over the United States</span>
<span class="n">us</span> <span class="o">=</span> <span class="n">hf</span><span class="o">.</span><span class="n">country_bbox</span><span class="p">(</span><span class="s2">&quot;United States&quot;</span><span class="p">)</span> 
<span class="n">goes</span> <span class="o">=</span> <span class="n">Goes16</span><span class="p">(</span><span class="n">us</span><span class="p">,</span><span class="s2">&quot;2020-07-28T18:40:18&quot;</span><span class="p">,</span><span class="s2">&quot;2020-07-29T00:00:00&quot;</span><span class="p">)</span>

<span class="c1"># view the results from the GOES16 collection</span>
<span class="n">first_img</span> <span class="o">=</span> <span class="n">goes</span><span class="o">.</span><span class="n">collection</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">viz_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;min&quot;</span><span class="p">:</span><span class="mf">0.05</span><span class="p">,</span>
    <span class="s2">&quot;max&quot;</span><span class="p">:</span><span class="mf">0.55</span><span class="p">,</span>
    <span class="s2">&quot;bands&quot;</span><span class="p">:</span><span class="s2">&quot;swir1,nir,green&quot;</span><span class="p">,</span>
    <span class="s2">&quot;gamma&quot;</span><span class="p">:</span><span class="mf">1.5</span><span class="p">,</span>
    <span class="s2">&quot;region&quot;</span><span class="p">:</span><span class="n">us</span><span class="p">,</span>
    <span class="s2">&quot;dimensions&quot;</span><span class="p">:</span><span class="mi">1024</span><span class="p">,</span>
    <span class="s2">&quot;crs&quot;</span><span class="p">:</span><span class="s2">&quot;epsg:5070&quot;</span>
<span class="p">}</span>
<span class="nb">print</span><span class="p">(</span><span class="n">first_img</span><span class="o">.</span><span class="n">getThumbURL</span><span class="p">(</span><span class="n">viz_params</span><span class="p">))</span> 
</code></pre></div>

<p><img alt="" src="../img/datasets_goes_class.png" /></p>
<p>In this example of a custom dataset class for GOES16 imagery, the <code>qa()</code> method definition is more for preprocessing to scale the imagery. A custom cloud/shadow masking workflow can easily be included and applied on the imagery. Now we are ready to use our custom GOES16 imagery with the rest of the <code>hydrafloods</code> functions!</p>
<p>More detailed information on the <code>hydrafloods.Dataset</code> class along with it's method fucntionality and arguments can be found in the <a href="/datasets/">datasets module</a> API reference. </p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../getting-started/" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Getting Started
              </div>
            </div>
          </a>
        
        
          <a href="../algorithms/" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Algorithms
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.7e0ee788.min.js"></script>
      <script src="../assets/javascripts/bundle.c1ccee15.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.4ac00218.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>